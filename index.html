<html>

<head>

    <title>
        GtL (Beta)
    </title>

</head>

<body>

    <canvas id="myCanvas" width=x height=y style="border:1px solid" + main_stroke_color> </canvas>
    
    <div style="margin-left: 10px;">
    
        <h3 id="selection">
            Edit Mode
        </h3> 
        
        <input type="search" placeholder="Preview" id="preview" disabled="true" hidden="true">

        <table style="text-align: left;">

            <tr>
                <th> <b style="font-size: 10px;">Drawing Functionality:</b> </th>            
                <th> <button onclick="set_mode(param=1)"> Circle </button> </th>
                <th> <button onclick="set_mode(param=2)"> Square </button> </th>
                <th> <button onclick="set_mode(param=5)"> Text </button> </th>                
                <th> <button onclick="set_mode(param=3)"> Line </button> </th>
            </tr>
            <tr>
                <th> <b style="font-size: 10px;">Editing Functionality:</b> </th>                
                <th> <button onclick="switch_grid_status()"> Grid </button> </th>
                <th> <button onclick="switch_curve_status()"> Curve </button> </th>
                <th> <button onclick="clear_canvas(clear_objects=true)"> Clear </button> </th>                                    
                <th> <button onclick="set_mode(param=4)"> Edit </button> </th>                
            </tr>
            <tr>
                <th> <b style="font-size: 10px;">Scaling:</b> </th>
                <th> <button onclick="scale(operator='+')"> + </button> </th>
                <th> <button onclick="scale(operator='-')"> - </button> </th>                
            </tr>

        </table>
        
        <br>

        <button onclick="safe()"> Safe Graph to File</button>

        <br>

        <button onclick="load_from_json();"> Load Graph </button>
        <input type="file" value="Load">
        
        <br>
        
        <h5 id="mouse" hidden="true"> 0,0 </h5>
        
        <br>
        
        <i style="color: #d0d0d0; font-size: 10px;">GtL (Beta) by @Maximilian L&ouml;ffler</i>
    
    </div>

    <script type="text/javascript" src="objects.js"></script>
    <script type="text/javascript" src="helpers.js"></script>
    <script type="text/javascript" src="grid_functions.js"></script>
    <script type="text/javascript" src="global_varibales.js"></script>
    <script type="text/javascript" src="event_handling.js"></script>

    <script>

    let draw = function() {
        
        clear_canvas(clear_objects=false);

        for (var i = 0; i < lines.length; i++) {
            s = lines[i].s;
            e = lines[i].e;

            ctx.strokeStyle = main_stroke_color;

            // the line
            ctx.beginPath();
            ctx.moveTo(s.get_x(), s.get_y());
            if (curve_status) {
                x_diff = (e.get_x() - s.get_x()) / 5;
                y_diff = s.get_y() - e.get_y();
                y_diff =  y_diff > 0 ? Math.abs(y_diff) / 2 : -Math.abs(y_diff) / 2;
                bez_1_x = s.get_x() + x_diff * 1.5;
                bez_1_y = s.get_y() - y_diff * 1.5;
                bez_2_x = e.get_x() - x_diff * 2;
                bez_2_y = e.get_y() - y_diff / 8;
                ctx.bezierCurveTo(bez_1_x, bez_1_y, bez_2_x, bez_2_y, e.get_x(), e.get_y())                
            } else {
                ctx.lineTo(e.get_x(), e.get_y());
            }
            ctx.stroke();

            // the "triangle"
            ctx.beginPath();
            ctx.arc(e.get_x(), e.get_y(), 5, 0, 2 * Math.PI);
            ctx.fillStyle = main_stroke_color;
            ctx.fill();
        }

        for (var i = 0; i < objects.length; i++) {
            
            x = objects[i].get_x();
            y = objects[i].get_y();
            type = objects[i].type;

            if (type == "circle") {
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, 2 * Math.PI);
                ctx.fillStyle = "white";
                ctx.fill();
            } else if (type == "square") {
                if (!objects[i].is_text()) {
                    ctx.beginPath();
                    ctx.rect(x - square_w / 2, y - square_h / 2, square_w, square_h);
                    ctx.fillStyle = "white";
                    ctx.fill();
                } 
            }

            ctx.fillStyle = objects[i].get_color();
            ctx.strokeStyle = objects[i].get_color();
            
            ctx.lineWidth = 1;
            ctx.stroke();

            ctx.font = text_size + " Arial";
            ctx.textAlign = "center";
            ctx.fillText(objects[i].get_content(), x, y + Number(text_size.replace('px', '') / 2));
        }
    }

    window.onresize = rescale_canvas;
    window.onload = function(event) {
        rescale_canvas();
        draw();
    }

    </script>

</body>

</html>